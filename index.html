<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
  let dados = [];

  async function carregarDados() {
    const res = await fetch('dados.json');
    dados = await res.json();
    inicializarBusca();
  }

  let fuse;

  function inicializarBusca() {
    const opcoes = {
      keys: [
        "CODIGO",
        "DESCRICAO_OS",
        "DESCRICAO_SUB_OS",
        "SERVICO_REALIZADO"
      ],
      threshold: 0.4, // sensibilidade da busca (0 = exato, 1 = muito flexível)
      includeScore: true
    };

    fuse = new Fuse(dados, opcoes);
    filtrar(); // mostra todos ao carregar
  }

  function filtrar() {
    const termo = document.getElementById('busca').value.trim();

    let resultados = [];
    if (termo === "") {
      resultados = dados.map(d => ({ item: d, score: 0 }));
    } else {
      resultados = fuse.search(termo);
    }

    const container = document.getElementById('resultados');
    container.innerHTML = "";

    resultados.sort((a, b) => a.score - b.score); // ordena por relevância

    resultados.forEach(r => {
      const item = r.item;
      container.innerHTML += `
        <div class="os-card">
          <div class="codigo">Código: ${item.CODIGO}</div>
          <div><strong>Descrição OS:</strong> ${item.DESCRICAO_OS}</div>
          <div><strong>Sub OS:</strong> ${item.DESCRICAO_SUB_OS}</div>
          <div><strong>Serviço:</strong> ${item.SERVICO_REALIZADO}</div>
        </div>
      `;
    });

    if (resultados.length === 0) {
      container.innerHTML = "<p>Nenhum resultado encontrado.</p>";
    }
  }

  carregarDados();
</script>
