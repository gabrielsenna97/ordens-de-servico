<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- [Todo o conteúdo do head permanece EXATAMENTE IGUAL] -->
  <!-- Manter todo o CSS original sem alterações -->
  <style>
    /* [Todo o conteúdo do style permanece EXATAMENTE IGUAL] */
  </style>
</head>
<body>
  <!-- [Todo o conteúdo do body HTML permanece EXATAMENTE IGUAL] -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      let banco = [];
      let dadosCarregados = false;

      // Elementos DOM
      const buscaInput = document.getElementById('busca');
      const resultadoDiv = document.getElementById('resultado');
      const notification = document.getElementById('notification');

      // Atualiza o ano automaticamente
      document.getElementById('current-year').textContent = new Date().getFullYear();

      // Carrega os dados do JSON
      async function carregarDados() {
        try {
          resultadoDiv.innerHTML = '<em>Carregando dados...</em>';
          
          const response = await fetch('dados.json');
          
          if (!response.ok) {
            throw new Error(`Erro HTTP! Status: ${response.status}`);
          }
          
          banco = await response.json();
          
          // Validação básica dos dados
          if (!Array.isArray(banco)) {
            throw new Error('Formato inválido: o JSON deve conter um array');
          }
          
          dadosCarregados = true;
          resultadoDiv.innerHTML = '<em>Digite um código ou palavra-chave acima...</em>';
          
        } catch (error) {
          console.error('Erro ao carregar dados:', error);
          resultadoDiv.innerHTML = `
            <em class="erro">Erro ao carregar os dados. Verifique:</em>
            <ul>
              <li>Se o arquivo <strong>dados.json</strong> existe</li>
              <li>Se o formato do JSON está correto</li>
              <li>Se o servidor está acessível</li>
            </ul>
            <p>Usando dados de exemplo como fallback...</p>
          `;
          
          // Dados de fallback
          banco = [
            {
              "CODIGO": "F083",
              "DESCRICAO_OS": "Bucha",
              "DESCRICAO_SUB_OS": "Inspeção de juntas e mangueiras",
              "SERVICO_REALIZADO": "Trou da junta do cânter e limpeza da área"
            }
          ];
          dadosCarregados = true;
        }
      }

      // Função de busca
      window.buscar = function() {
        if (!dadosCarregados) {
          resultadoDiv.innerHTML = '<em>Dados ainda não carregados. Aguarde...</em>';
          return;
        }
        
        const termo = document.getElementById('busca').value.trim().toLowerCase();
        const resultado = document.getElementById('resultado');

        if (!termo) {
          resultado.innerHTML = '<em>Por favor, digite algo para buscar.</em>';
          return;
        }

        const itensEncontrados = banco.filter(item => 
          Object.values(item).some(
            valor => valor && valor.toString().toLowerCase().includes(termo)
          )
        );

        mostrarResultados(itensEncontrados, termo);
      };

      // [As funções mostrarResultados, escapeTexto e copiarTexto permanecem EXATAMENTE IGUAIS]

      // Inicia o carregamento dos dados
      carregarDados();
    });
  </script>
</body>
</html>
