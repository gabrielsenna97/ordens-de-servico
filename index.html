<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- [Cabeçalho e CSS permanecem iguais] -->
</head>
<body>
  <!-- [Estrutura HTML permanece igual] -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Variáveis globais
      let banco = [];
      let dadosCarregados = false;
      const resultado = document.getElementById('resultado');
      
      // Atualiza o ano automaticamente
      document.getElementById('current-year').textContent = new Date().getFullYear();
      
      // Carrega os dados do JSON
      carregarDados();

      // Função para carregar os dados do JSON
      function carregarDados() {
        resultado.innerHTML = '<em class="loading">Carregando dados...</em>';
        
        // Substitua pelo caminho correto do seu arquivo JSON
        fetch('dados.json')
          .then(response => {
            if (!response.ok) {
              throw new Error('Erro ao carregar o arquivo JSON');
            }
            return response.json();
          })
          .then(data => {
            banco = data;
            dadosCarregados = true;
            resultado.innerHTML = '<em>Digite um código ou palavra-chave para buscar...</em>';
            console.log('Dados carregados com sucesso:', banco); // Para debug
          })
          .catch(error => {
            console.error('Erro ao carregar dados:', error);
            resultado.innerHTML = `
              <em>Erro ao carregar os dados:</em>
              <p>${error.message}</p>
              <p>Verifique se o arquivo dados.json existe e está no formato correto.</p>
            `;
            
            // Fallback com dados mockados
            banco = [
              {
                "CODIGO": "F083",
                "DESCRICAO_OS": "Bucha",
                "DESCRICAO_SUB_OS": "Inspeção de juntas e mangueiras",
                "SERVICO_REALIZADO": "Trou da junta do cânter e limpeza da área"
              }
            ];
            dadosCarregados = true;
            console.log('Usando dados mockados como fallback');
          });
      }

      // [Restante do código permanece igual...]
      
      // Função de busca
      window.buscar = function() {
        if (!dadosCarregados) {
          resultado.innerHTML = '<em class="loading">Dados ainda não carregados. Aguarde...</em>';
          return;
        }
        
        const termo = document.getElementById('busca').value.trim().toLowerCase();
        
        if (!termo) {
          resultado.innerHTML = '<em>Por favor, digite algo para buscar.</em>';
          return;
        }

        const itensEncontrados = banco.filter(item => 
          Object.values(item).some(
            valor => valor && valor.toString().toLowerCase().includes(termo)
        );

        mostrarResultados(itensEncontrados, termo);
      };

      // [Demais funções permanecem iguais...]
    });
  </script>
</body>
</html>
