<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- [Manter todo o cabeçalho e CSS anteriores] -->
</head>
<body>
  <!-- [Manter toda a estrutura HTML anterior] -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 1. Variáveis globais
      let banco = [];
      let dadosCarregados = false;
      const resultado = document.getElementById('resultado');
      
      // Atualiza o ano
      document.getElementById('current-year').textContent = new Date().getFullYear();
      
      // 2. Função principal de carregamento
      function iniciarAplicacao() {
        // Mostra status inicial
        resultado.innerHTML = '<em class="loading">Carregando dados...</em>';
        
        // Tenta carregar de 3 formas diferentes
        Promise.any([
          carregarArquivoJSON('dados.json'),
          carregarArquivoJSON('dados_os.json'),
          carregarDadosFallback()
        ])
        .then(dados => {
          banco = dados;
          dadosCarregados = true;
          mostrarStatus(`Pronto! ${banco.length} ordens de serviço carregadas.`);
          console.log('Dados carregados:', banco);
        })
        .catch(error => {
          console.error('Falha ao carregar dados:', error);
          mostrarStatus('Erro ao carregar dados. Recarregue a página.', 'error');
        });
      }

      // 3. Função para carregar arquivo JSON
      async function carregarArquivoJSON(nomeArquivo) {
        return new Promise(async (resolve, reject) => {
          try {
            const response = await fetch(nomeArquivo);
            
            if (!response.ok) {
              reject(new Error(`Arquivo ${nomeArquivo} não encontrado`));
              return;
            }
            
            const dados = await response.json();
            
            // Validação básica do JSON
            if (!Array.isArray(dados) {
              reject(new Error(`O arquivo ${nomeArquivo} não contém um array válido`));
              return;
            }
            
            if (dados.length === 0) {
              reject(new Error(`O arquivo ${nomeArquivo} está vazio`));
              return;
            }
            
            resolve(dados);
          } catch (error) {
            reject(error);
          }
        });
      }

      // 4. Fallback com dados incorporados
      async function carregarDadosFallback() {
        return new Promise((resolve) => {
          // Simula um pequeno atraso para parecer natural
          setTimeout(() => {
            const dados = [
              {
                "CODIGO": "",
                "DESCRICAO_OS": "TROCA DE FILTROS",
                "DESCRICAO_SUB_OS": "MAQUINA APRESENTANDO BAIXA PRESSÃO DE COMBUSTIVEL 3,8BAR",
                "SERVICO_REALIZADO": "OCORRÊNCIA: GRUPO GERADOR APRESENTANDO BAIXA PRESSÃO DE COMBUSTIVEL 3,8BAR , APÓS INSPEÇÃO FOI CONSTATADO QUE OS FILTROS DE COMBUSTIVEL PRIMARIO E SECUNDARIO ESTAVAM BASTANTE SUJOS, NECESSÁRIO A SUBSTITUIÇÃO. FOI REALIZADO A SUBSTITUIÇÃO DOS FILTROS DE COMBUSTIVEL PRIMARIO E SECUNDARIO, FEITO INSPEÇÃO NAS MAGUEIRAS DE COMBUSTIVEL, FEITO INSPEÇÃO NA VALVULA SOLENOIDE, FORAM UTILIZADOS: 01 FILTRO PRIMÁRIO BOSCH (COD: 20620) 01 FILTRO SECUNDÁRIO BOSCH (COD: 20618) SERVIÇO REALIZADO POR (OPERADOR E MANTENEDOR)."
              },
              {
                "CODIGO": "",
                "DESCRICAO_OS": "TROCA DE OLEO (PREVENTIVA 250 HORAS)",
                "DESCRICAO_SUB_OS": "MANUTENÇÃO PREVENTIVA - 250 H ~ 13 DIAS (TROCA DE ÓLEO E FILTROS)",
                "SERVICO_REALIZADO": "FOI REALIZADO A TROCA DE OLEO, TROCA DO FILTRO DE OLEO, FEITO A COLETA DE AMOSTRA DE OLEO, LIMPEZA E INSPEÇÃO NA GALERIA DO FILTRO DE AR, LIMPEZA E TROCA DOS ORINGS E PLACA DE INSERÇÃO DO FILTRO CENTRIFUGO, INSPEÇÃO NAS MANGEIRAS DE COMBUSTIVEL, INSPEÇÃO DE LIMALHAS NO FILTRO DE OLEO, INSPEÇÃO NAS ENGRENAGENS INTERMEDIARIAS, FORAM UTILIZADOS: 39 LT ÓLEO MOBIL 15W40 (COD: 9071) 1 FILTRO DE ÓLEO LUBRIFICANTE (COD: 20619) 1 PLACA DE INSERÇÃO (COD: 11093) 1 KIT CONTRATO (COD: 9254) 1 ANEL CENTRIFUGO. (COD: 9873)1 ANEL CENTRIFUGO (COD: 9874) 1 ANEL DE VEDAÇÃO DO CENTRIFUGO (COD: 9875) 03 LTS ES COMPLEAT (COD.:1015) 01 LLC500 (COD.18025) 01 LT DESENGRAXANTE (COD.8945) SERVIÇO REALIZADO POR: (OPERADOR E MANTENEDOR)."
              }
              // Adicione aqui todos os outros itens do seu JSON
            ];
            
            console.log('Usando dados fallback incorporados');
            resolve(dados);
          }, 500); // Pequeno atraso para melhor UX
        });
      }

      // 5. Função para mostrar status
      function mostrarStatus(mensagem, tipo = 'success') {
        const classes = {
          'success': 'success-message',
          'error': 'error-message',
          'info': 'info-message'
        };
        
        resultado.innerHTML = `
          <div class="${classes[tipo] || 'info-message'}">
            ${mensagem}
          </div>
          <em>Digite um código ou palavra-chave para buscar...</em>
        `;
      }

      // [Manter as funções buscar(), mostrarResultados(), escapeTexto() e copiarTexto() anteriores]

      // 6. Inicializa a aplicação
      iniciarAplicacao();
    });
  </script>
</body>
</html>
